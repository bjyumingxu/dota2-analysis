# 🚀 详细部署步骤 - Railway + Vercel

## 📋 前置要求

1. **GitHub账号**（用于连接代码仓库）
2. **Railway账号**（免费注册：https://railway.app）
3. **Vercel账号**（免费注册：https://vercel.com）

---

## 第一步：准备代码仓库

### 1.1 初始化Git仓库（如果还没有）

```bash
cd D:\cursorPRO\opendotaAI
git init
git add .
git commit -m "Initial commit: Dota2战绩分析网页"
```

### 1.2 推送到GitHub

1. 在GitHub创建新仓库（例如：`dota2-analysis`）
2. 添加远程仓库：
```bash
git remote add origin https://github.com/你的用户名/dota2-analysis.git
git branch -M main
git push -u origin main
```

---

## 第二步：部署后端（Railway）

### 2.1 注册Railway账号

1. 访问：https://railway.app
2. 点击"Start a New Project"
3. 选择"Login with GitHub"
4. 授权Railway访问你的GitHub账号

### 2.2 创建新项目

1. 在Railway控制台，点击"New Project"
2. 选择"Deploy from GitHub repo"
3. 选择你的代码仓库（`dota2-analysis`）
4. Railway会自动检测到这是一个Python项目

### 2.3 配置项目设置

1. **选择服务目录**：
   - 在项目设置中，找到"Root Directory"
   - 设置为：`backend`

2. **配置启动命令**：
   - Railway会自动检测，但确认一下：
   - 应该是：`uvicorn src.main:app --host 0.0.0.0 --port $PORT`

### 2.4 配置环境变量

在Railway项目设置中，点击"Variables"标签，添加：

```
OPENDOTA_API_BASE_URL=https://api.opendota.com/api
CORS_ORIGINS=*
```

**注意**：`CORS_ORIGINS` 先设置为 `*`，等前端部署后再改为前端域名。

### 2.5 等待部署完成

1. Railway会自动开始构建和部署
2. 等待部署完成（通常需要2-5分钟）
3. 部署成功后，Railway会提供一个URL，例如：
   ```
   https://your-app-name.up.railway.app
   ```

### 2.6 测试后端API

1. 访问健康检查：`https://your-app-name.up.railway.app/health`
   - 应该返回：`{"status":"ok"}`

2. 访问API文档：`https://your-app-name.up.railway.app/docs`
   - 应该能看到Swagger文档

**保存后端URL，下一步需要用到！**

---

## 第三步：部署前端（Vercel）

### 3.1 注册Vercel账号

1. 访问：https://vercel.com
2. 点击"Sign Up"
3. 选择"Continue with GitHub"
4. 授权Vercel访问你的GitHub账号

### 3.2 创建新项目

1. 在Vercel控制台，点击"Add New Project"
2. 选择你的GitHub仓库（`dota2-analysis`）
3. 点击"Import"

### 3.3 配置项目设置

1. **Root Directory**：设置为 `frontend`
2. **Framework Preset**：选择 `Vite`
3. **Build Command**：`npm run build`（自动检测）
4. **Output Directory**：`dist`（自动检测）

### 3.4 配置环境变量

在项目设置中，点击"Environment Variables"，添加：

```
VITE_API_BASE_URL=https://your-app-name.up.railway.app
```

**注意**：将 `your-app-name.up.railway.app` 替换为你的实际Railway后端URL！

### 3.5 部署

1. 点击"Deploy"
2. Vercel会自动构建和部署
3. 等待部署完成（通常需要1-3分钟）

### 3.6 获取前端URL

部署完成后，Vercel会提供一个URL，例如：
```
https://dota2-analysis.vercel.app
```

---

## 第四步：更新CORS配置

### 4.1 更新后端CORS

1. 回到Railway项目设置
2. 找到"Variables"
3. 修改 `CORS_ORIGINS`：
   ```
   CORS_ORIGINS=https://dota2-analysis.vercel.app
   ```
   **注意**：将URL替换为你的实际Vercel前端URL！

4. Railway会自动重新部署

---

## 第五步：测试完整功能

### 5.1 测试前端

1. 访问你的Vercel前端URL
2. 输入一个Steam账号ID（例如：245003691）
3. 点击查询
4. 应该能看到分析结果

### 5.2 检查功能

- [ ] 可以正常查询账号
- [ ] 显示一句话点评
- [ ] 显示胜率曲线
- [ ] 显示最佳战友/最爱损友
- [ ] 显示数据统计
- [ ] 背景图片正常显示

---

## 🐛 常见问题解决

### Q1: Railway部署失败？

**检查**：
1. 确认Root Directory设置为 `backend`
2. 确认requirements.txt存在且正确
3. 查看Railway的部署日志（点击"Deployments"查看）

**常见错误**：
- Python版本不对：确保使用Python 3.11+
- 依赖安装失败：检查requirements.txt

### Q2: Vercel部署失败？

**检查**：
1. 确认Root Directory设置为 `frontend`
2. 确认package.json存在且正确
3. 查看Vercel的构建日志

**常见错误**：
- Node.js版本不对：Vercel会自动选择，但可以手动设置
- 构建命令错误：确认是 `npm run build`

### Q3: 前端无法连接后端？

**检查**：
1. 确认环境变量 `VITE_API_BASE_URL` 已设置
2. 确认后端URL正确（可以访问 `/health` 测试）
3. 确认CORS配置正确（允许前端域名）

**调试**：
1. 打开浏览器开发者工具（F12）
2. 查看"网络"标签
3. 查看API请求是否发送成功
4. 查看控制台是否有错误

### Q4: API请求返回CORS错误？

**解决**：
1. 确认后端CORS_ORIGINS包含前端域名
2. 确认前端域名格式正确（包含 `https://`）
3. 重新部署后端（Railway会自动重新部署）

---

## ✅ 部署完成检查清单

### 后端（Railway）
- [ ] 项目已创建并连接GitHub
- [ ] Root Directory设置为 `backend`
- [ ] 环境变量已配置
- [ ] 部署成功，可以访问 `/health`
- [ ] 可以访问 `/docs` 查看API文档
- [ ] CORS已配置为前端域名

### 前端（Vercel）
- [ ] 项目已创建并连接GitHub
- [ ] Root Directory设置为 `frontend`
- [ ] 环境变量 `VITE_API_BASE_URL` 已设置
- [ ] 部署成功，可以访问页面
- [ ] 可以正常查询账号并显示结果

### 功能测试
- [ ] 可以查询账号
- [ ] 所有功能正常显示
- [ ] 背景图片正常显示
- [ ] 移动端可以正常访问

---

## 🎉 完成！

部署完成后，你的网站就可以在公网访问了！

**前端URL**：`https://your-app.vercel.app`
**后端URL**：`https://your-app.railway.app`

你可以把这个URL分享给任何人，他们都可以使用你的Dota2战绩分析网页！

---

## 📝 后续维护

### 更新代码

1. 修改代码
2. 提交到GitHub：
   ```bash
   git add .
   git commit -m "更新说明"
   git push
   ```
3. Railway和Vercel会自动检测并重新部署

### 查看日志

- **Railway**：在项目设置中点击"Deployments"查看日志
- **Vercel**：在项目设置中点击"Deployments"查看日志

### 监控

- Railway和Vercel都提供基本的监控功能
- 可以查看访问量、错误率等

---

**如果遇到任何问题，随时告诉我！** 🚀

