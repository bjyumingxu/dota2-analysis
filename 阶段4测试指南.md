# 阶段4：前后端联调测试指南

## ✅ 已完成的工作

1. **后端功能完善**
   - ✅ 完善了最佳战友/最爱损友分析功能
   - ✅ 实现了从比赛详情中提取队友数据
   - ✅ 修复了类型注解问题

2. **前端功能完善**
   - ✅ 添加了最佳战友图表显示
   - ✅ 添加了最爱损友图表显示
   - ✅ 实现了空状态提示

## 🧪 测试步骤

### 1. 启动后端服务

在 `backend` 目录下：

```bash
# 激活虚拟环境（如果还没激活）
.\venv\Scripts\Activate.ps1  # Windows PowerShell
# 或
venv\Scripts\activate.bat     # Windows CMD

# 启动服务
uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

**检查点**：
- [ ] 服务成功启动，显示 `Uvicorn running on http://0.0.0.0:8000`
- [ ] 访问 http://localhost:8000/docs 可以看到API文档
- [ ] 访问 http://localhost:8000/health 返回 `{"status":"ok"}`

### 2. 启动前端服务

在 `frontend` 目录下（新开一个终端）：

```bash
# 安装依赖（如果还没安装）
npm install

# 启动开发服务器
npm run dev
```

**检查点**：
- [ ] 服务成功启动，显示 `Local: http://localhost:5173/`
- [ ] 浏览器可以访问 http://localhost:5173

### 3. 功能测试

#### 测试1：基础查询功能

1. 打开浏览器访问 http://localhost:5173
2. 输入一个Steam账号ID（例如：123456789）
3. 点击"查询"按钮

**预期结果**：
- [ ] 显示加载动画
- [ ] 如果账号存在，显示分析结果
- [ ] 如果账号不存在，显示友好的错误提示

#### 测试2：一句话点评

**检查点**：
- [ ] 显示一句话点评卡片
- [ ] 点评内容包含KDA、胜率等信息
- [ ] 文字清晰易读

#### 测试3：胜率曲线图

**检查点**：
- [ ] 显示胜率曲线图表
- [ ] 鼠标悬停在节点上显示该场游戏详情
- [ ] 图表样式美观，符合深色主题

#### 测试4：最佳战友/最爱损友

**检查点**：
- [ ] 如果有组队数据，显示柱状图
- [ ] 如果没有组队数据，显示"暂无组队数据"提示
- [ ] 鼠标悬停显示队友详细信息
- [ ] 最佳战友按胜场数排序
- [ ] 最爱损友按败场数排序

#### 测试5：数据概括

**检查点**：
- [ ] 显示5个数据卡片（击杀、死亡、助攻、正补、伤害）
- [ ] 每个卡片显示总数值和平均值
- [ ] 数据格式正确

#### 测试6：错误处理

**测试场景**：
1. 输入无效的账号ID（非数字）
2. 输入不存在的账号ID
3. 网络断开时查询

**检查点**：
- [ ] 输入非数字时显示"账号ID必须是数字"
- [ ] 账号不存在时显示友好提示
- [ ] 网络错误时有适当的错误提示

#### 测试7：响应式布局

**检查点**：
- [ ] 在桌面浏览器（1920x1080）正常显示
- [ ] 在平板尺寸（768px）正常显示
- [ ] 在手机尺寸（375px）正常显示
- [ ] 所有元素都可以正常访问

### 4. 性能测试

**检查点**：
- [ ] 首次查询响应时间 < 5秒
- [ ] 图表渲染流畅，无卡顿
- [ ] 页面切换流畅

## 🐛 常见问题排查

### 问题1：后端启动失败

**可能原因**：
- 端口8000被占用
- 依赖未安装

**解决方案**：
```bash
# 检查端口占用（Windows）
netstat -ano | findstr :8000

# 重新安装依赖
pip install -r requirements.txt
```

### 问题2：前端无法连接后端

**可能原因**：
- 后端未启动
- CORS配置问题

**解决方案**：
- 确保后端服务正在运行
- 检查浏览器控制台是否有CORS错误
- 确认vite.config.ts中的proxy配置正确

### 问题3：图表不显示

**可能原因**：
- ECharts未正确加载
- 数据格式不正确

**解决方案**：
- 检查浏览器控制台是否有JavaScript错误
- 确认数据格式符合预期
- 检查图表容器的ref是否正确绑定

### 问题4：最佳战友/损友数据为空

**可能原因**：
- 该账号没有与同一队友组队超过1次
- 比赛详情获取失败

**解决方案**：
- 这是正常情况，如果账号确实没有组队数据
- 检查后端日志，看是否有比赛详情获取失败的错误
- 可以尝试使用其他有组队记录的账号测试

## 📊 测试账号推荐

你可以使用以下方式获取测试账号：

1. **访问OpenDota**：https://www.opendota.com/
2. **搜索玩家**：在搜索框输入玩家名称
3. **获取账号ID**：从URL中获取，例如 `/players/123456789`

**推荐测试账号**：
- 使用你自己的Steam账号ID（如果有Dota2游戏记录）
- 使用OpenDota首页展示的玩家账号

## ✅ 测试完成检查清单

完成所有测试后，确认：

- [ ] 后端服务正常运行
- [ ] 前端服务正常运行
- [ ] 所有功能模块正常工作
- [ ] 错误处理正常
- [ ] 响应式布局正常
- [ ] 性能满足要求
- [ ] 没有明显的bug

## 🚀 下一步

完成测试后，如果一切正常，我们就可以进入**阶段5：部署上线**了！

如果发现问题，请告诉我具体的错误信息，我会帮你修复。

